<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui">
<ui:define name="metadata">
    <f:metadata>
        <f:viewAction action="#{languageBean.setLanguage}"/>
    </f:metadata>
</ui:define>

<h:head>
</h:head>
<h:body>
    <ui:composition template="/template/common/layout.xhtml">
        <ui:define name="content">
            <p:panelGrid columns="1">
                <p:row>
                    <h2 style="color: cornflowerblue">Auftragsverwaltung</h2>
                </p:row>
                <p:row>
                    <p>Hier koennen Sie sowohl aus ihren Prozesskettenvorlagen, als auch aus unbenutzten Prozessschritten
                        neue Auftraege erstellen. Sie koennen dem Auftrag auch eine Prioritaet zuweisen. Sobald Sie bereit
                        sind den Auftrag zu starten, druecken Sie einfach auf Freigeben neben dem Auftrag, um diesen Freizugeben.</p>
                </p:row>
                <p:row>
                    <p:panel id="auftragErstellen" header="Auftrag Erstellen"
                             style="margin-bottom: 20px">
                        <p:panelGrid>
                            <h:form>
                                <p:row>
                                    <p:column colspan="1">
                                        <h:outputText value="Prozesskettenvorlage"/>
                                    </p:column>
                                    <p:column colspan="1">
                                        <p:selectOneMenu id="pkv"
                                                         value="#{dtAuftragBean.selectedProzesskettenVorlage}"
                                                         converter="omnifaces.SelectItemsConverter" effect="fade"
                                                         var="pkv" style="width: 172px" filter="true"
                                                         filterMatchMode="contains" required="true"
                                                         requiredMessage="Bitte Prozesskettenvorlage eingeben!">
                                            <f:selectItems value="#{dtAuftragBean.availableProzessKettenVorlagen}"
                                                           var="pkv" itemLabel="#{pkv.name}"
                                                           itemValue="#{pkv}" required="true"/>
                                            <p:column>
                                                <h:outputText value="#{pkv.name}"/>
                                            </p:column>
                                        </p:selectOneMenu>
                                    </p:column>
                                    <p:column colspan="1">
                                        <h:outputText value="Prioritaet"/>
                                    </p:column>
                                    <p:column colspan="1">
                                        <p:selectOneMenu id="priority"
                                                         value="#{dtAuftragBean.selectedPriority}"
                                                         converter="omnifaces.SelectItemsConverter" effect="fade"
                                                         var="priority" style="width: 172px" filter="true"
                                                         filterMatchMode="contains" required="true"
                                                         requiredMessage="Bitte Prozesskettenvorlage eingeben!">
                                            <f:selectItems value="#{dtAuftragBean.availablePriorities}"
                                                           var="priority" itemLabel="#{priority}"
                                                           itemValue="#{priority}" required="true"/>
                                            <p:column>
                                                <h:outputText value="#{priority}"/>
                                            </p:column>
                                        </p:selectOneMenu>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column colspan="1">
                                        <h:outputText value="Auftragsname"/>
                                    </p:column>
                                    <p:column colspan="1">
                                        <p:inputText placeholder="Name" required="true"
                                                     requiredMessage="Bitte Auftragsname eingeben!"
                                                     value="#{dtAuftragBean.selectedName}"/>
                                    </p:column>
                                    <p:column colspan="1">
                                        <p:commandButton value="Reset" type="reset" icon="pi pi-trash"/>
                                    </p:column>
                                    <p:column colspan="1">
                                        <p:commandButton value="Erstellen" action="#{dtAuftragBean.createJob}"
                                                         ajax="false" icon="pi pi-check"/>
                                    </p:column>
                                </p:row>
                            </h:form>
                        </p:panelGrid>
                    </p:panel>
                </p:row>
                <p:row>
                    <p:panel header="Auftrag aus bestehenden Prozesssschritten erstellen">
                        <p:panelGrid>
                            <h:form>
                                <p:row>
                                    <p:column colspan="1">
                                        <h:outputText value="Prozesschritt Reihenfolge"/>
                                    </p:column>
                                    <p:column colspan="3">
                                        <p:pickList id="pk" value="#{dtAuftragBean.dualListModel}" var="pk"
                                                    itemLabel="#{pk}"
                                                    itemValue="#{pk}" required="true" requiredMessage="Bitte prozesschrittreihenfolge eingeben!">
                                            <o:converter converterId="omnifaces.ListConverter"
                                                         list="#{dtAuftragBean.dualListModel.source}"/>
                                        </p:pickList>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column colspan="1">
                                        <h:outputText value="Auftragsname"/>
                                    </p:column>
                                    <p:column colspan="1">
                                        <p:inputText placeholder="Name" required="true"
                                                     requiredMessage="Bitte Auftragsname eingeben!"
                                                     value="#{dtAuftragBean.selectedName}"/>
                                    </p:column>
                                    <p:column colspan="1">
                                        <h:outputText value="Prioritaet"/>
                                    </p:column>
                                    <p:column colspan="1">
                                        <p:selectOneMenu id="priority3"
                                                         value="#{dtAuftragBean.selectedPriority}"
                                                         converter="omnifaces.SelectItemsConverter" effect="fade"
                                                         var="priority" style="width: 172px" filter="true"
                                                         filterMatchMode="contains" required="true"
                                                         requiredMessage="Bitte Prozesskettenvorlage eingeben!">
                                            <f:selectItems value="#{dtAuftragBean.availablePriorities}"
                                                           var="priority" itemLabel="#{priority}"
                                                           itemValue="#{priority}" required="true"/>
                                            <p:column>
                                                <h:outputText value="#{priority}"/>
                                            </p:column>
                                        </p:selectOneMenu>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column colspan="1">
                                        <p:commandButton value="Reset" type="reset" icon="pi pi-trash"/>
                                    </p:column>
                                    <p:column colspan="1">
                                        <p:commandButton value="Erstellen"
                                                         action="#{dtAuftragBean.createJobFromAvailable}"
                                                         icon="pi pi-check" ajax="false"/>
                                    </p:column>
                                </p:row>
                            </h:form>
                        </p:panelGrid>
                    </p:panel>
                </p:row>
                <p:row>
                    <h:form id="form">
                        <p:dataTable id="table" var="job" value="#{dtAuftragBean.availableJobs}"
                                     editable="true"
                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {Exporters}"
                                     paginator="true" rows="15" style="margin-bottom:20px">
                            <p:ajax event="rowEdit" listener="#{dtAuftragBean.edit(job.pkID)}"
                                    update="form:table"/>
                            <p:ajax event="rowEditCancel" listener="#{dtAuftragBean.onRowEditCanceled}"
                                    update="form:table"/>
                            <p:column headerText="Auftragsname">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="#{job.name}"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputText placeholder="Name" required="true"
                                                     requiredMessage="Bitte Auftragsname eingeben!"
                                                     value="#{dtAuftragBean.selectedName}"/>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column headerText="Status">
                                <h:outputText value="#{job.prozessKettenZustandsAutomat}"/>
                            </p:column>
                            <p:column headerText="Prioritaet">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="#{job.priority}"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:selectOneMenu id="priority2"
                                                         value="#{dtAuftragBean.selectedPriority}"
                                                         converter="omnifaces.SelectItemsConverter" effect="fade"
                                                         var="priority" style="width: 172px" filter="true"
                                                         filterMatchMode="contains" required="true"
                                                         requiredMessage="Bitte Prozesskettenvorlage eingeben!">
                                            <f:selectItems value="#{dtAuftragBean.availablePriorities}"
                                                           var="priority" itemLabel="#{priority}"
                                                           itemValue="#{priority}" required="true"/>
                                            <p:column>
                                                <h:outputText value="#{priority}"/>
                                            </p:column>
                                        </p:selectOneMenu>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column headerText="Prozessschritte" colspan="2">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <p:commandButton value="Anzeigen" icon="pi pi-external-link" update="dialog1" oncomplete="PF('dlg1').show();"/>
                                        <p:sidebar header="ProzessSchritt Uebersicht" widgetVar="dlg1" modal="true"
                                                  height="100" id="dialog1" style="width: 50%">
                                            <p:panelGrid columns="2">
                                                <p:row>
                                                    <p:dataTable id="tableqle" var="ps" value="#{job.prozessSchritte}"
                                                                 editable="true" style="margin-bottom:20px" scrollable="true" scrollHeight="400">
                                                        <p:column headerText="Name">
                                                            <h:outputText value="#{ps.name}"/>
                                                        </p:column>
                                                        <p:column headerText="Experimentierstation">
                                                            <h:outputText value="#{dtAuftragBean.getES(ps.id)}"/>
                                                        </p:column>
                                                        <p:column headerText="Dauer">
                                                            <h:outputText value="#{ps.duration}"/>
                                                        </p:column>
                                                    </p:dataTable>
                                                </p:row>
                                            </p:panelGrid>
                                        </p:sidebar>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:pickList id="pk2" value="#{dtAuftragBean.dualListModel}" var="pk"
                                                    itemLabel="#{pk}"
                                                    itemValue="#{pk}" required="true" requiredMessage="Bitte prozesschrittreihenfolge eingeben!">
                                            <o:converter converterId="omnifaces.ListConverter"
                                                         list="#{dtAuftragBean.dualListModel.source}"/>
                                        </p:pickList>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column headerText="Freigabe">
                                <p:commandButton value="Freigeben" action="#{dtAuftragBean.setStarted(job.pkID)}"
                                                 ajax="true" update="form:table" icon="pi pi-check"/>
                            </p:column>
                            <p:column>
                                <p:commandButton value="Abbrechen" action="#{dtAuftragBean.remove(job.pkID)}"
                                                 ajax="true" update="form:table" icon="pi pi-trash"/>
                            </p:column>
                            <p:column>
                                <p:commandButton value="Delete" icon="pi pi-trash" ajax="true" update="form:table"
                                                 action="#{dtAuftragBean.remove(job.pkID)}"/>
                            </p:column>
                            <p:column>
                                <p:rowEditor/>
                            </p:column>
                        </p:dataTable>
                    </h:form>
                </p:row>
            </p:panelGrid>
        </ui:define>
    </ui:composition>
</h:body>
</html>
