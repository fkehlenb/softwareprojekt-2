<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:shiro="http://shiro.apache.org/tags">
<ui:define name="metadata">
    <f:metadata>
        <f:viewAction action="#{languageBean.setLanguage}"/>
    </f:metadata>
</ui:define>

<h:head>
    <title>Prozess Schritt Verwaltung - SFB Farbige Zustaende</title>
    <link rel="icon" href="../background.png"/>
</h:head>

<body background="../background.png">
<shiro:authenticated>
    <shiro:hasRole name="pkAdmin">
        <ui:composition template="/template/common/layout.xhtml">
            <ui:define name="content">
                <h:head>
                    <title>Prozess Schritt Verwaltung - SFB Farbige Zustaende</title>
                    <link rel="icon" href="../background.png"/>
                </h:head>
                <p:growl>
                    <p:autoUpdate/>
                </p:growl>
                <p:panelGrid columns="1">
                    <p:row>
                        <h2 style="color: cornflowerblue">Prozessschritt Verwaltung</h2>
                    </p:row>
                    <p:row>
                        <p>In der unteren Tabelle sehen Sie alle im System existierende Prozessschritte.
                            Sie koennen noch nicht gestartete Prozessschritte beliebig verwalten, gestartete
                            Prozessschritte koennen nicht veraendert werden!
                            Mit dem unteren Formular koennen Sie neue Prozessschritte erstellen.</p>
                    </p:row>
                    <p:row>
                        <h:form>
                            <p:panelGrid>
                                <p:row>
                                    <p:column colspan="1">
                                        <h:outputText value="Zustandsautomat"/>
                                    </p:column>
                                    <p:column colspan="1">
                                        <p:selectOneMenu id="zustandsautomat2"
                                                         value="#{psView.prozessSchrittZustandsAutomatVorlage}"
                                                         converter="omnifaces.SelectItemsConverter" effect="fade"
                                                         var="zustandsautomat" style="width: 172px" filter="true"
                                                         filterMatchMode="contains" required="true"
                                                         requiredMessage="Bitte prozessschritt vorlage eingeben!">
                                            <f:selectItems
                                                    value="#{psView.prozessSchrittZustandsAutomatVorlages}"
                                                    var="zustandsautomat" itemLabel="#{zustandsautomat.name}"
                                                    itemValue="#{zustandsautomat}" required="true"/>
                                            <p:column>
                                                <h:outputText value="#{zustandsautomat.name}"/>
                                            </p:column>
                                        </p:selectOneMenu>
                                    </p:column>
                                    <p:column colspan="1">
                                        <h:outputText value="Prozessschrittdauer"/>
                                    </p:column>
                                    <p:column colspan="1">
                                        <p:inputText placeholder="Dauer" required="true"
                                                     requiredMessage="Bitte Dauer eingeben!" value="#{psView.psDauer}"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column colspan="1">
                                        <h:outputText value="Prozessschritt Parameter"/>
                                    </p:column>
                                    <p:column colspan="1">
                                        <p:selectOneMenu id="prozessschrittparameter"
                                                         value="#{psView.prozessSchrittParameter}"
                                                         converter="omnifaces.SelectItemsConverter"
                                                         effect="fade"
                                                         var="prozessschrittparameter" style="width: 172px"
                                                         filter="true"
                                                         filterMatchMode="contains" required="true"
                                                         requiredMessage="Bitte experimentierstation waehlen!">
                                            <f:selectItems value="#{psView.prozessSchrittParameters}"
                                                           var="prozessschrittparameter"
                                                           itemLabel="#{prozessschrittparameter.name}"
                                                           itemValue="#{prozessschrittparameter}" required="true"/>
                                            <p:column>
                                                <h:outputText value="#{prozessschrittparameter.name}"/>
                                            </p:column>
                                        </p:selectOneMenu>
                                    </p:column>
                                    <p:column colspan="1">
                                        <h:outputText value="Prozessschritt Name"/>
                                    </p:column>
                                    <p:column colspan="1">
                                        <p:inputText placeholder="Prozessschritt Name" required="true"
                                                     requiredMessage="Bitte prozessschrittname eingeben!"
                                                     value="#{psView.prozessSchrittName}"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column colspan="1">
                                        <h:outputText value="Experimentierstation"/>
                                    </p:column>
                                    <p:column colspan="1">
                                        <p:selectOneMenu id="experimentierstation2"
                                                         value="#{psView.experimentierStation}"
                                                         converter="omnifaces.SelectItemsConverter"
                                                         effect="fade"
                                                         var="experimentierstation" style="width: 172px"
                                                         filter="true"
                                                         filterMatchMode="contains" required="true"
                                                         requiredMessage="Bitte experimentierstation waehlen!">
                                            <f:selectItems value="#{psView.experimentierStations}"
                                                           var="experimentierstation"
                                                           itemLabel="#{experimentierstation.name}"
                                                           itemValue="#{experimentierstation}" required="true"/>
                                            <p:column>
                                                <h:outputText value="#{experimentierstation.name}"/>
                                            </p:column>
                                        </p:selectOneMenu>
                                    </p:column>
                                    <p:column colspan="1">
                                        <h:outputText value="Attribute"/>
                                    </p:column>
                                    <p:column colspan="1">
                                        <p:inputText placeholder="Attribute" requiredMessage="Bitte attribute angeben!"
                                                     required="true" value="#{psView.attributes}"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column colspan="1">
                                        <p:commandButton value="Reset" type="reset" icon="pi pi-trash"/>
                                    </p:column>
                                    <p:column colspan="1">
                                        <p:commandButton value="Einfuegen" icon="pi pi-check"
                                                         action="#{psView.createPS}" update="form:table"/>
                                    </p:column>
                                </p:row>
                            </p:panelGrid>
                        </h:form>
                    </p:row>
                    <p:row>
                        <h:form>
                            <p:panelGrid>
                                <p:column colspan="1">
                                    <h:outputText value="Prozessschritte als JSON exportieren"/>
                                </p:column>
                                <p:column colspan="1">
                                    <p:commandButton value="Export" action="#{psView.toJson}" icon="pi pi-save"/>
                                </p:column>
                            </p:panelGrid>
                        </h:form>
                    </p:row>
                    <style type="text/css">
                        .broken {
                            background-color: red !important;
                        }
                    </style>
                    <p:row>
                        <h:form id="form">
                            <p:dataTable id="table" var="ps" value="#{psView.prozessSchrittV2s}" editable="true"
                                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {Exporters}"
                                         paginator="true" rows="15" rowStyleClass="#{ps.prozessSchrittZustandsAutomat.current eq 'Kapputt' ? 'broken' : null}" style="margin-bottom:20px">
                                <p:ajax event="rowEdit" listener="#{psView.onRowEdit(ps.id)}"
                                        update="form:table"/>
                                <p:ajax event="rowEditCancel" listener="#{psView.onRowCancel}"
                                        update="form:table"/>
                                <p:column headerText="Prozessschritt Name">
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText value="#{ps.name}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText placeholder="Name" required="true"
                                                         requiredMessage="Bitte name eingeben!"
                                                         value="#{psView.prozessSchrittName}"/>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>
                                <p:column headerText="Status">
                                    <h:outputText value="#{ps.prozessSchrittZustandsAutomat.current}"/>
                                </p:column>
                                <p:column headerText="Zustandsautomat">
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText
                                                    value="#{ps.prozessSchrittZustandsAutomat.prozessSchrittZustandsAutomatVorlage.name}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:selectOneMenu id="zustandsautomat"
                                                             value="#{psView.prozessSchrittZustandsAutomatVorlage}"
                                                             converter="omnifaces.SelectItemsConverter" effect="fade"
                                                             var="zustandsautomat" style="width: 172px" filter="true"
                                                             filterMatchMode="contains" required="true"
                                                             requiredMessage="Bitte prozessschritt vorlage eingeben!">
                                                <f:selectItems
                                                        value="#{psView.prozessSchrittZustandsAutomatVorlages}"
                                                        var="zustandsautomat" itemLabel="#{zustandsautomat.name}"
                                                        itemValue="#{zustandsautomat}" required="true"/>
                                                <p:column>
                                                    <h:outputText value="#{zustandsautomat.name}"/>
                                                </p:column>
                                            </p:selectOneMenu>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>
                                <p:column headerText="Dauer">
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText value="#{ps.duration}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText placeholder="Dauer" requiredMessage="Bitte Dauer angeben!"
                                                         required="true"
                                                         value="#{psView.psDauer}"/>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>
                                <p:column headerText="Experimentierstation">
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText value="#{ps.experimentierStation}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:selectOneMenu id="experimentierstation"
                                                             value="#{psView.experimentierStation}"
                                                             converter="omnifaces.SelectItemsConverter"
                                                             effect="fade"
                                                             var="experimentierstation" style="width: 172px"
                                                             filter="true"
                                                             filterMatchMode="contains" required="true"
                                                             requiredMessage="Bitte experimentierstation waehlen!">
                                                <f:selectItems value="#{psView.experimentierStations}"
                                                               var="experimentierstation"
                                                               itemLabel="#{experimentierstation.name}"
                                                               itemValue="#{experimentierstation}" required="true"/>
                                                <p:column>
                                                    <h:outputText value="#{experimentierstation.name}"/>
                                                </p:column>
                                            </p:selectOneMenu>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>
                                <p:column headerText="Prozessschritt Parameter">
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText value="#{ps.prozessSchrittParameter}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:selectOneMenu id="prozessschrittparameter2"
                                                             value="#{psView.prozessSchrittParameter}"
                                                             converter="omnifaces.SelectItemsConverter"
                                                             effect="fade"
                                                             var="prozessschrittparameter" style="width: 172px"
                                                             filter="true"
                                                             filterMatchMode="contains" required="true"
                                                             requiredMessage="Bitte experimentierstation waehlen!">
                                                <f:selectItems value="#{psView.prozessSchrittParameters}"
                                                               var="prozessschrittparameter"
                                                               itemLabel="#{prozessschrittparameter.name}"
                                                               itemValue="#{prozessschrittparameter}" required="true"/>
                                                <p:column>
                                                    <h:outputText value="#{prozessschrittparameter.name}"/>
                                                </p:column>
                                            </p:selectOneMenu>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>
                                <p:column headerText="Attribute">
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText value="#{ps.attributes}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText placeholder="Attribute"
                                                         requiredMessage="Bitte attribute angeben!"
                                                         required="true" value="#{psView.attributes}"/>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>
                                <p:column headerText="Prozessschritt Log">
                                    <p:commandButton value="Show Log" onclick="PF('dlg2').show();"/>
                                    <p:dialog header="Prozessschritt Log Uebersicht" widgetVar="dlg2" modal="true"
                                              height="100">
                                        <p:panelGrid columns="1">
                                            <p:row>
                                                <p:dataTable id="table2" var="psLog" value="#{ps.prozessSchrittLog}"
                                                             editable="true"
                                                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {Exporters}"
                                                             paginator="true" rows="15" style="margin-bottom:20px">
                                                    <p:column headerText="Log Zustand">
                                                        <h:outputText value="#{psLog.zustandsAutomat}"/>
                                                    </p:column>
                                                    <p:column headerText="Gestartet">
                                                        <h:outputText value="#{psLog.gestartet}"/>
                                                    </p:column>
                                                    <p:column headerText="Beendet">
                                                        <h:outputText value="#{psLog.geendet}"/>
                                                    </p:column>
                                                </p:dataTable>
                                            </p:row>
                                        </p:panelGrid>
                                    </p:dialog>
                                </p:column>
                                <p:column>
                                    <p:commandButton value="Delete" icon="pi pi-trash"
                                                     action="#{psView.delete(ps.id)}" ajax="true"
                                                     update="form:table"/>
                                </p:column>
                                <p:column style="width:35px">
                                    <p:rowEditor/>
                                </p:column>
                            </p:dataTable>
                        </h:form>
                    </p:row>
                </p:panelGrid>
            </ui:define>
        </ui:composition>
    </shiro:hasRole>
</shiro:authenticated>
</body>
</html>
